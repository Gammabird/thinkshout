---
layout: post
title: Don't let arrays make you loopy!
---

<div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>As a Drupal developer, I spend 90% of my time mucking with PHP arrays. And as much as I love a foreach control structure, PHP provides some nice functions that can get you what you need from an array without having to loop through a huge Drupal Node array.</p>

<p>For example, say I wanted to filter some nodes to see if they were referencing a specific Vocabulary term: The <a href="http://php.net/manual/en/function.array-filter.php">array_filter</a> function can be used to filter out empty values from an array, but it can also be used with a callback function to filter based on whatever specification you want:</p>

<p>Here's the simple "Filter out empty values" behavior:</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />&nbsp;&nbsp;&nbsp; $array </span><span style="color: #007700">= array(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">1 </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Apple'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">2 </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">NULL</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">3 </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">1</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp; );<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$filtered_array </span><span style="color: #007700">= </span><span style="color: #0000BB">array_filter</span><span style="color: #007700">(</span><span style="color: #0000BB">$array</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$filtered_array</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #FF8000">// Returns: Array ( [1] =&gt; Apple [3] =&gt; 1 )<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<p>But what if we wanted to filter for anything with a specific value?</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #007700">function </span><span style="color: #0000BB">apple_callback</span><span style="color: #007700">(</span><span style="color: #0000BB">$item</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(</span><span style="color: #0000BB">$item </span><span style="color: #007700">== </span><span style="color: #DD0000">'Apple'</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return </span><span style="color: #0000BB">TRUE</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return </span><span style="color: #0000BB">FALSE</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$callback_filtered_array </span><span style="color: #007700">= </span><span style="color: #0000BB">array_filter</span><span style="color: #007700">(</span><span style="color: #0000BB">$array</span><span style="color: #007700">, </span><span style="color: #DD0000">'apple_callback'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$callback_filtered_array</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #FF8000">// Returns: Array ( [1] =&gt; Apple )<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>

<h3>Dynamically filtering with a closure</h3>

<p>As of <a href="http://www.php.net/manual/en/functions.anonymous.php">PHP 5.3</a>, the callback function can also be a "closure", or anonymous function. This allows for dynamically setting the value for the filter, which is awesome:</p>

<p><div class="codeblock"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #007700">function </span><span style="color: #0000BB">filter_closure</span><span style="color: #007700">(</span><span style="color: #0000BB">$filter_value</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return function(</span><span style="color: #0000BB">$item</span><span style="color: #007700">) use(</span><span style="color: #0000BB">$filter_value</span><span style="color: #007700">) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return </span><span style="color: #0000BB">$item </span><span style="color: #007700">== </span><span style="color: #0000BB">$filter_value</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$dynamic_variable </span><span style="color: #007700">= </span><span style="color: #DD0000">'Apple'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$anonymous_filter </span><span style="color: #007700">= </span><span style="color: #0000BB">filter_closure</span><span style="color: #007700">(</span><span style="color: #0000BB">$dynamic_variable</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">$array_filtered_closure </span><span style="color: #007700">= </span><span style="color: #0000BB">array_filter</span><span style="color: #007700">(</span><span style="color: #0000BB">$array</span><span style="color: #007700">, </span><span style="color: #0000BB">$anonymous_filter</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$array_filtered_closure</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp; </span><span style="color: #FF8000">// Returns: Array ( [1] =&gt; Apple )<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div></p>
</div></div></div><div class="field field-name-taxonomy-vocabulary-1 field-type-taxonomy-term-reference field-label-above"><div class="field-label">Tags:&nbsp;</div><div class="field-items"><div class="field-item even"><a href="/blog/category/drupal-planet" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Drupal Planet</a></div><div class="field-item odd"><a href="/blog/category/howto" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">HowTo</a></div><div class="field-item even"><a href="/blog/category/php" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">PHP</a></div></div></div>
